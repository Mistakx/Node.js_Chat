<!doctype html>

<html lang="en">

    <head>

        <meta charset="UTF-8">
        <title>Passport example</title>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>

        <script>

            function addUserDetails() {

                const socket = io();
                const socketIdSpan = document.getElementById("socketId");
                const usernameSpan = document.getElementById("username");

                socket.on('connect', () => {

                    socketIdSpan.innerText = socket.id;

                    socket.emit('whoami', (username) => {
                        usernameSpan.innerText = username;
                    });

                });

                // TODO: Add User Rooms

            };

            $(document).ready(function () {

                let socket = io();

                // Leave room submit button clicked
                $('#leaveRoomForm').submit(function () {
                    socket.emit('leaveRoom', $('#leaveRoomIDFormInput').val());
                    $('#leaveRoomIDFormInput').val('');
                    location.href = '/';
                    return false;
                });

                // Enter room submit button clicked
                $('#enterRoomForm').submit(function () {
                    // socket.emit('enterRoom', $('#enterRoomFormInput').val());
                    let chatURL = "/chat/" + $('#enterRoomFormInput').val();
                    $('#enterRoomFormInput').val('');
                    location.href = chatURL;
                    return false;
                });

                // Create room submit button clicked
                $('#createRoomForm').submit(function () {
                    socket.emit('createRoom', $('#createRoomFormInput').val());
                    $('#createRoomFormInput').val('');
                    location.href = '/';
                    return false;
                });

                // Join room submit button clicked
                $('#joinRoomForm').submit(function () {
                    socket.emit('joinRoom', $('#joinRoomFormInput').val());
                    //console.log($('#m').val());
                    $('#joinRoomFormInput').val('');
                    location.href = '/';
                    return false;
                });

                // Add user to room button clicked
                $('#addUserToRoomForm').submit(function () {
                    socket.emit('addUserToRoom', { room: $('#roomIDFormInput').val(), usernameToAdd: $('#usernameToAddFormInput').val() });
                    $('#roomIDFormInput').val('');
                    $('#usernameToAddFormInput').val('');
                    return false;
                });

                // Change room privacy settings button clicked
                $('#changeRoomPrivacyForm').submit(function () {
                    socket.emit('changeRoomPrivacy', $('#changePrivacyRoomIDFormInput').val());
                    $('#changePrivacyRoomIDFormInput').val('');
                    location.href = '/';
                    return false;
                });

            });

        </script>


    </head>

    <body>

        <p>Authenticated!</p>
        <p>Socket ID: <span id="socketId"></span></p>
        <p>Username: <span id="username"></span></p>
        <script>addUserDetails();</script> <!-- Fills the page with the authenticated user details-->

        <div>

            <!--Logout button-->
            <form action="/logout" method="post">

                <div>
                    <input type="submit" value="Log out" />
                </div>

            </form>

            <!--Go to chat button-->
            <button onclick="window.location='/chat'">Go to chat</button>

            <!--Add user to room FormButton-->
            <form id="addUserToRoomForm" action="">
                <input placeholder="Room ID" style="width:10%" id="roomIDFormInput" autocomplete="off" />
                <input placeholder="Username" style="width:10%" id="usernameToAddFormInput" autocomplete="off" />
                <button>Add user to Room</button>
            </form>

            <!--Leave Room FormButton-->
            <form id="leaveRoomForm" action="">
                <input style="width:10%" id="leaveRoomIDFormInput" autocomplete="off" />
                <button>Leave Room</button>
            </form>

            <!--Enter Room FormButton-->
            <form id="enterRoomForm" action="">
                <input style="width:10%" id="enterRoomFormInput" autocomplete="off" />
                <button>Enter Room</button>
            </form>

            <!--Create Room FormButton-->
            <form id="createRoomForm" action="">
                <input style="width:10%" id="createRoomFormInput" autocomplete="off" />
                <button>Create Room</button>
            </form>

            <!--Join Room FormButton-->
            <form id="joinRoomForm" action="">
                <input style="width:10%" id="joinRoomFormInput" autocomplete="off" />
                <button>Join Room</button>
            </form>

            <!--Change room privacy settings FormButton-->
            <form id="changeRoomPrivacyForm" action="">
                <input style="width:10%" id="changePrivacyRoomIDFormInput" autocomplete="off" />
                <button>Change room privacy</button>
            </form>

        </div>

        <p>Chat Rooms</p>
        <%- userData %>

    </body>

</html>
